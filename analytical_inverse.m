clc;
close all;
clear all;

global n_source n_fft an2 bn2 theta n_sample data_measure 
global lam_J reg_switch eps eps_ball eps0

% k_source = 2;
% lam_J = 0.0000001;
eps = 10^(-14);
eps0 = 10^(-10);
eps_ball = 10^(-3);
% lam_J = 0;
%%%% regularization switch 0 for none, 1 for mumford shah, 2 for tichonov, 3 for TV l1
reg_switch = 1;
str = 4;
fin = 4;
inner_lam = 1;

samples = 1000;
n_spec = 30;
level = (10^-3);
n_fft = samples;
n_sample = samples;
h_integral = 2*pi/(n_sample-1);
kk = 1;

theta = -pi:h_integral:pi;
% noise = level*normrnd(0,0.1,1,n_sample);
% noise = level*randn(1,n_sample);
% noise = [0.000526994861375782,-0.000271312883196378,0.00103517944524183,0.00134366161473322,-0.000327861912734066,0.000687771864143907,-0.000415574680765979,0.000895861664183906,0.000787511395394157,-0.000738412581456021,0.000445715203449389,0.000413380114790861,-0.000635960444103068,-0.000393198428463838,0.000336738177457226,0.000407317300491746,0.00125994206308971,-0.000288592332981064,0.00144841450246014,0.000237659956824667,-0.000419784143479559,4.66683496071628e-05,0.000879780312089711,0.000778341947274675,-0.00143355592090381,0.000329347451035592,0.00224419600091841,-0.00132171886477125,0.000341114992168283,-7.60598487479876e-05,-0.000589004533509272,-0.000892107020536865,-0.000349982398441078,0.00100376182805144,0.000697081244360409,0.00138107623035086,-0.000251917546587343,0.00164872210161918,0.000889231070879306,0.00131991528561954,0.00140698553242507,-0.00114291279436102,-0.000603347671250494,0.00100713914577686,0.00128951603897908,-0.000323889237675909,0.000163174601352762,0.000562318466240423,-0.000273538836237075,-0.00184673336792032,-9.53729105795338e-05,0.000246425506286889,0.000299224636383377,-0.000182859805330028,-0.000380948698111105,-0.000396991028085304,3.95509387865968e-05,0.000824524777303577,-0.000902598090619879,0.000649304384475377,0.00159676110495519,-4.00436381735779e-05,0.00112312672499522,-0.000121261188682069,0.000210948105955274,0.000214489064925979,0.000715761313891567,0.000394708742312892,0.000658824319644409,-0.000934734217584151,-0.00147745570788220,-0.000424361827780001,0.000169909420870323,0.000439101370846185,0.000690279224905345,0.00304432224251959,-0.00103524592593363,0.000283918546711317,-6.68183909237780e-05,-0.00143185251989500,-0.000418791520163245,-0.00109254381756424,-0.000674554142732087,0.000406370764345126,-0.000350172109652946,-0.00192919776192982,-6.67551679963491e-05,-0.00161012747653768,-0.00138382222454357,-0.000285450929805275,-0.000364630988892106,0.000195829321686517,8.07254233391880e-05,-0.000213920159425976,-0.000885840770710709,-0.000377434147147996,-0.00126740983750065,3.99351414452714e-05,0.000399055289647308,0.00102667746251433,0.00102120049532395,-0.000635531532870420,-0.000725245985974034,-0.00159098242411388,-0.000457086829838518,0.00124435566389478,-0.000874290146853212,0.000784510758486538,0.00132101998355516,0.000477686371604237,-0.000401391721640242,9.03966879995523e-05,0.000528733841193652,0.00104921756472467,0.000482594856404226,-0.00110405089908740,0.000823928559380106,-0.00158835457202466,0.000118451056473779,0.00110051694345481,-0.000879000016915811,0.00111538851602312,0.00111834429398766,0.000762902088997533,-0.000880835921265258,-0.000845679384080508,0.000817065294218473,0.00179379562950315,0.00119377687558837,0.000792391356642620,9.71211967408864e-05,-0.00103877177058204,0.000240274701852344,0.00123402085977921,-0.000502813468471770,0.000319696025252458,-0.000107827886006351,-0.000128653610889243,0.000392920633349075,-0.00142729652425004,-0.00117688093039808,0.00144357697573933,-0.000106287885555467,-0.00139745477605695,-0.000858316215334640,0.000656557076714172,-0.000698255474611491,0.00200431885988495,-0.00136914070015147,0.000164544791981741,-0.000656157252417421,0.000893710181414360,0.000275275260804034,-0.000686879072249845,-0.000999084402642611,-0.000279386824264996,0.000167780201004838,-0.000307349179921388,0.000207436248879707,-0.000170042976996448,0.000905688343921863,0.000268965811964947,4.77825151938026e-05,0.00109315692619006,-7.12605447095501e-05,-0.00126030653610638,-0.000605869080865094,-0.000460662612308588,-0.000406070045120401,-0.000391301268987335,-7.11110029278160e-05,0.000329387184747953,0.000303966440415167,-0.000944092135562089,0.000530599719428201,-2.87160789949241e-05,-0.000453851177803291,0.000888975697194902,-0.000598690981292199,0.000466535417388626,-0.00182909850459054,0.000882969354533448,0.000758861424933053,2.75895739325400e-05,0.00157447163011356,-0.00102239954127320,-0.00113300608427732,-0.000952071605238867,-0.00204248375813190,0.00156104311621656,-0.00103379794377537,-9.89333263354136e-05,-0.00139970962572690,-0.000428458861376689,-0.00128221367796154,0.00241406261263734,0.00188606964703802,0.00127135789700092,0.000116207930687564,0.000345127981264612,-0.00130957355734215,-0.000256578505724133,0.000417165494795560,-0.000256595948917338,0.000196494631570324,-0.00101686441468446,-0.00266313561769925,0.00145959817625202,0.000320465686131047,0.000603243774267682,0.000233174746745039,0.00254156804893408,0.000130970784265345,0.00198388866850455,2.71209857641765e-05,-0.000210695614713846,0.000458611115518337,0.00259316130170930,0.000663471600572321,-0.00132573053087399,-0.000224162152379112,0.00202355472445908,-1.47871730046525e-05,0.000396878007354840,0.00145978703264339,0.000270023050781435,0.000567873660951267,0.000536995917177768,0.000779694526814109,-0.000508363817340675,0.00143430715850070,0.000569400850644913,0.00306929744088541,-0.000221340993280807,0.000639252720897363,-0.000858731281622167,0.000999236024573267,-0.00259813944697062,0.00133071161408189,0.000704617848410265,6.57976108507336e-05,0.000141630865835352,-0.00121203450081710,-0.000832622788559277,-0.00150089205576730,-0.00142766284610084,0.00112435421661604,-0.000219260584409570,0.00116500739220464,0.000945159029186760,-0.00232711373329308,-0.000543856233510272,0.00206434023741255,-0.000137365645353762,0.000208707365082106,0.000308412715951714,0.000115525761672591,0.000140835547305608,-0.000548781941807129,-0.000350548645579078,0.000525361522197139,-0.00102577412876608,0.000511114907012319,-0.000463636041487144,-0.000160468307393955,0.000295883289332265,0.00107125005685966,0.00159815376149550,-0.000889484548113156,-0.00157268206333714,0.000921061419329936,0.000113890286827230,0.000383985695862613,0.00148183265253314,-0.000839583456065204,-0.000502036644644377,0.000638603176196246,-0.00167394365990269,-0.00129507418522019,3.87464659478688e-05,-0.000788135793022839,0.000425969211744142,-0.000205401786644416,-0.000312188829390142,-0.00115344173749894,-0.00268671545975818,0.00185328695635616,0.00134663278115792,-0.000241560030175959,0.00142814836726647,0.000492253847676799,-0.00213403066851748,0.000866806974447100,0.000729293782373560,0.000509555979063942,4.68327346230233e-05,-0.000248404921790840,-0.00202835676048181,0.00131307309990930,-9.15182238546606e-05,-0.00172138304975776,0.000176439919276017,-0.000356767822890450,0.000104199985518840,0.000330873321767925,-4.73958587617027e-05,-0.000417289185198319,-0.000971315923019642,-1.89440616655126e-05,-0.000421459050071305,2.88217305673275e-05,0.00137601537600535,0.000787713406897605,0.00134158759807549,0.000661510443340258,-3.31798653113866e-05,0.00116646175159956,0.00115096871013941,-0.00168967814006781,0.000675215369724723,-0.00156138488417619,0.000587856843185931,0.00140771465233214,-0.000199549694722436,0.000771584196140550,0.00165923302961251,0.000807729127849467,-0.000393015427642059,0.000239741557964652,-0.00104263497361378,0.00127520792895727,-0.000881844705637410,-0.000394051498533722,0.00154427011525977,0.00155304862090761,-0.00133825463891891,7.71509356119023e-05,0.00100852136675816,0.000800057579131998,-0.00159361887181195,-0.00146902966890368,0.000372625622832793,8.74505390270035e-05,-0.000629659858691536,0.000240497289908715,-0.000717752692753225,0.000483896078251192,-0.000305966365361476,-0.00120997971528915,0.000341251992673485,0.000876285126230212,0.00154663847189281,-7.65843499840118e-05,-0.000397675716660621,-0.000393892247635591,-0.00178133456770092,-2.81453026183163e-05,-0.000836258047493111,0.000359917856860944,-0.00328470815541481,-0.00102415869785891,-7.92505211154671e-05,-0.000852442094384895,-0.00126653293870555,0.00166394546908267,-0.00141156489531210,-0.000355872601108963,-0.00156639430414703,8.86078986660140e-05,-0.000144318964336127,-0.000212969579574859,0.000648728174102166,-0.000220614374099492,0.00215216780968800,-0.00156128403554641,0.000266209260746126,-0.00153454031109838,0.000210092359847661,-0.000368178306013592,-0.00147108533916581,0.00177667372941198,-0.00130070398188273,0.000304070852749598,-0.000120239360768264,-0.00183274331435837,0.000425047749425001,0.00152819119141778,0.00103319285848310,-0.00207957102588476,-0.00105956095853602,-0.000388175389722815,-6.97272330288064e-05,-2.29937862615797e-05,-0.000247195972029329,0.000672827099566449,0.000345506478956952,0.00269660081807195,0.00207321177847720,0.000996067315847880,-0.000251421419467200,0.000162135058582451,-0.000325973795600679,0.000412603867278604,0.000515269498543485,-0.00206475965110911,-0.000560700666023183,0.000467898839403931,0.00127465059657506,3.84234067643505e-05,-0.000661133604733808,-0.00151239500128041,-0.000768027686749578,-0.000810793342615307,0.00106376761481484,-0.00173748851004187,6.89889824038358e-06,-0.000738621762473652,-0.000766666810769526,0.00151715503361751,0.000808342673111376,-0.000187860853676067,-3.16513259253882e-05,-0.000204402377672687,0.00170773087146216,-0.00185965991439503,-0.000681960781137097,0.000136319063218983,0.000404192861423207,0.000158428137510759,-0.00216043085163077,-0.000348174604874519,0.000398104189317026,0.000857517343574357,0.000391722964852523,0.000493328340472538,0.000303319285423346,-0.00108901246462205,-0.000124541037441012,0.000260233506059738,0.00113071008859049,-6.54863292376338e-05,-0.00168206963240175,-0.000186824365459952,-3.09407597754449e-06,-0.00143199152498707,-0.000523240067136444,0.000131406421606072,-0.000688915007500927,0.00149063418663212,0.000915021863096111,0.000826740795185335,0.000241309957119385,0.000673647200370293,-0.00130480539252912,-0.000843971916828950,-0.00118810512307548,-0.000424422251536673,0.000813254737507764,-0.00143858105096425,-0.000705108853075633,0.000154683915651051,0.000656373544691225,-0.00142245857302937,0.00138513437257680,0.000252476434557701,0.000790732955921026,0.000719374544594226,-0.00174842700869923,-0.000129388727509761,-0.000937858548327984,0.00169585156755389,6.20555549669919e-05,-0.000362327630103602,-0.000995672255929711,-0.000377918613569880,-0.00113912541601178,-0.000323047421481290,0.000338538866899733,0.000752761547400294,-0.000753888802052849,-0.000467954324352751,0.00141365691924775,0.00115541975897974,-0.000805781830491139,-0.00138955898963035,0.00106285776205485,0.000513047649036485,-0.000642449089491294,0.000761608551980291,-0.000795980202084276,0.00189807128913931,-0.000379530693803348,-0.000950872204299337,-0.000505079217605704,-0.000324808553544570,0.000346999171262320,-0.000274852434124458,-0.000646947312337049,-0.00110473293335057,0.00128824839711639,-0.00271935409956902,0.00170109152897222,-0.000770342215988627,0.000575757399124781,-0.00123701417054467,-0.00125899087473659,0.000219424962023434,0.000365449558006457,-0.00105097847584584,0.000182345866188167,0.000105507710252729,0.000459654573951808,0.00224854752016767,-0.00103636584915191,-0.000305989654327179,0.00223767934161430,0.000121240072939180,0.000746807941010575,0.000652126952454228,0.00143306794086457,0.000848158487466860,-0.00258540167195548,0.00108549329776001,0.000234686710387213,0.000765297375681885,0.00106234982986753,-0.000585037985644344,0.00190190065424979,0.000491662179793946,-0.000686818218746588,0.000397077316414250,-0.00148408316117939,-0.00237272583013166,0.000546138922219277,-0.000292573211218007,-0.000132322403203574,-0.000999499097970482,-8.53584035494108e-06,-0.000569244509408554,-0.000310000265893911,-0.000278076511329658,8.49801425504334e-05,-0.00130614341853236,-0.000530492471851703,0.000810117065847453,0.00124836651468122,-0.000463675388301260,0.000306083361690180,-0.000493103229744177,0.000270345197277975,-0.000517973786370777,-0.000148909722718356,0.000799434070037609,0.000736448900549287,-4.05988971199042e-06,-0.00175137070675792,0.00160092737999546,-0.000331625714499482,-0.000136993893563473,0.00107812594793892,-0.00141481066025710,-0.000182752542464683,0.00186491116902300,-0.00142567351919999,0.00285196750696213,0.00143421462401626,0.00275962425888050,-0.000463340503465777,0.00125896917016738,0.00150175052078462,0.000804203775891028,0.000263544308552579,-0.00146296295822026,0.00106908893079963,-0.00150256136343221,-0.000479301613427470,-0.000161483813917756,0.00106821524196456,-6.80896561637913e-05,-0.00133202812206034,-9.26684595433815e-05,-0.000114857848305773,0.000812294932050965,-0.00103465022679808,-0.00216975959184186,8.16749659858399e-05,-0.000508454653071348,-0.00109070283264365,0.00232036585282039,-6.53840350147062e-05,0.000562954972225046,-0.000708476641948717,-3.06211834707386e-05,0.000424534531243440,0.000218615177096622,-0.000171913358118680,-0.00143751355361281,-0.000313538782850284,0.000752064037520548,0.000736060245482471,0.00126458979191372,-0.000165880286480220,0.00140942519577187,-0.000351501082616936,-0.00182284977746790,-0.000174396426643661,0.00106449736324230,-0.00145606492128466,-0.00237150995868611,-0.00231941492076494,-0.00135232112118992,0.000689467161773341,0.000150235471727063,0.00202953381732368,0.000816539308561691,-0.000968418272514866,-0.00120225043064377,-0.00119209719776837,0.000412738865754116,0.000189950076299273,0.000377106047606995,9.99024732099139e-05,-0.00110295053358494,0.000108408431243659,0.000264714912109777,0.000445388305716632,-0.000739402450344789,0.000579976150963780,-0.000552901467694718,-0.00135779477248144,0.00115761152704743,0.000751056632577414,0.000776313407003311,0.00172896269871716,-0.00198212020083022,0.000209115825553668,-0.00153537590121828,-0.000710290179131050,-0.00137044797851330,0.00165601860025209,-0.000387400242246405,0.000647028170992534,-0.000236620358785082,0.000568337229687016,0.00244532123848013,-0.000377238072018162,0.00283652117655259,-0.000713831925492859,-7.98548803029182e-05,-0.000438871759736314,6.65020259267372e-05,0.00126328209617722,0.00150342320058855,0.00127295358006680,-0.00140785197478674,0.000539064862721294,-0.00146179652929935,-0.000382474151475679,0.000329287469008101,-0.000546865294487996,-0.00184154071221454,-0.000568695587141470,-0.00104168805696923,0.000260975057061092,0.000274551988706585,-0.00140367721619144,0.00120471307594431,0.000137807299158066,0.000410336330701873,0.00141640514012360,-0.000523858416768040,-0.00306766855212923,0.000243922469671839,-0.000277526416466724,0.000607767474717766,0.000426448719590559,-0.000417141451998519,-0.000460281657797130,-0.000935526308570922,0.00150291526720343,-0.00126778634846314,-0.000914959272329805,-0.000906751101235039,-0.00164153527458812,0.000405945308651566,-0.000410097415793515,-0.000172966986852819,-0.00143484883852778,0.000121032211441887,-0.00119232475595599,-0.00112606840120546,0.000693283678646556,0.00134982411930709,0.000942818628823099,-0.000393549411042808,-0.00122991431908668,-0.000742483613526903,0.00113386466568242,-0.000412417845644566,0.000630258200406029,2.81135981075315e-05,0.00111157079280999,-0.00109394798620644,0.000792146685421930,-0.000147465319974067,0.00101437697217005,-0.00254499339434329,0.00203210512684875,9.65009563008241e-05,-6.83782478171292e-05,0.000668205008746812,0.000807369886591229,0.000478138119973873,0.000232809826634308,-0.000685525855394163,-0.000585470566255276,-0.00147266450557508,-0.000571958186119288,0.00265512881961661,-0.00222679667995103,0.000906021292890552,0.000200322998584749,-0.000775983350203310,-0.00123714664367843,-0.000516454149029014,0.000790939211019839,-0.000248209557870529,0.000755051185169852,-5.25797853021839e-05,-0.000940926519314635,0.000365803577210748,-0.00119262688769620,0.000859304072135524,-0.000945116804751253,0.00200297212471052,-0.00163334443024454,-0.000115703313773735,-0.000292344426754762,-0.00112588431899632,2.69295640970046e-05,-0.000366098459324635,0.00138915850401873,-0.00107026941105614,0.000240705595590086,-0.00122188997532334,-0.000541332292192249,0.000607934971060716,0.000729945546075643,-0.000929254637770020,0.000875691766747929,6.59415079013375e-05,-0.000182159091130945,-0.000822130441496212,-0.000656665246564265,0.00160633571014402,0.000303069509751015,0.00154564721014329,0.000611065813831935,0.000255017272858002,-0.000378038909894358,0.000485010170263658,-0.00219172327050823,0.000708651684818030,0.00130147451585851,0.000312609366195021,-0.000216476170242299,-0.000807089713921703,-0.000127208644357190,-0.000760109484176209,-0.00103937989983102,0.000786878473667944,0.000890618002104987,0.00121358433679597,0.000306142752318793,-0.000277762736481352,-0.000539642437096733,0.00103363172101751,0.00214886418039708,0.000729338398573888,-0.000621405138330306,-0.000701599633130171,-0.000682848092082788,0.000377503757733111,0.00122842886798157,0.000124376273422646,-0.000275372570711718,-0.00104918101931141,-0.000907320355527483,-0.00110017852821348,-0.000632958620922387,0.00102058696757159,-0.000369088620299470,0.00101769776137839,0.000174475862834098,0.000140853172922893,-0.000477273817325817,-0.000138439799284338,0.000832247127383823,0.00134198873313512,-0.000258492898942256,-0.000654823608843667,0.00156073395109640,0.000794639389607017,0.00233707279082172,0.00109976213494069,-0.000786025128375680,-0.000895258727374088,0.00111790473998476,0.00174307752867035,-0.00199896235368177,-0.000152224986607316,0.000289385174976452,0.000377633964382235,0.00138158143879115,-6.43950585695177e-07,0.000531779443737880,0.000195968766441361,-0.000953744386930309,-0.00152971555160454,0.000437075265380480,-0.000223966437768047,-0.000294010542597354,0.00148209251256727,0.000302739972760351,-0.000586799415378589,-0.00131582872420951,-0.000333342079741116,-0.000311469116796344,-0.000556507464479081,-0.00154389853092151,-0.00355477341601749,0.00148332529484660,-0.00119676841933357,0.000954255409814746,-0.000436933525902085,-0.000692235347580699,0.00278737086021020,-0.000677853992334299,0.00161849319688022,0.000765689682287285,0.00115223749366181,-0.00128459487278358,0.000988258311432316,-0.000177338162196826,-3.60192620781950e-05,0.000100450987348895,-0.00123132154321556,-0.00144107339208800,0.000211181809306174,-0.000173772927259783,-0.00148663238469205,0.000208861134431791,0.00102141003172371,-0.00133755975263254,4.43208221056382e-05,-0.000158563708058598,0.000679552845450706,0.00146440718862749,0.000261238386536927,-0.000414473775604347,-0.00134631226234694,-0.00109667399029472,-0.000418169855018366,0.000418930269001109,-0.00121884134957710,0.000330702925621556,-0.00145526084771107,-0.000493355358227870,0.000280458559834809,0.000152103370489376,0.000209751601657994,0.000632714901528251,-0.000868630202251274,0.000205922483860858,0.000976440343804159,0.00266405132116364,-0.00146734974400702,0.000290552953341408,0.000193733524176236,0.00102970390046190,0.000304610915659525,0.00157496431432238,7.63705664453531e-05,-0.000298373484273370,-0.000419001248029875,-0.00222312313358038,0.000816050697866013,0.000139973100079816,0.00143786987368041,0.00211861485633470,0.000949944390889304,-0.00199250828473671,-0.000350888388868762,-0.000576893754908244,0.00149920896268122,0.00126576970182933,0.000533118264827993,-0.00101273445236611,0.000512205972336331,3.72281509470159e-05,0.000556932489431293,0.000380404867397183,0.000541031443539398,8.69961047206823e-05,-0.000548368213556708,0.000758996477634346,-0.00170919413363548,-0.000164993264466995,0.00124540684544943,0.000118401749313057,-0.000756671158717712,-0.00200826893545646,0.000765101007571498,0.00184468519777179,-0.00122296944198980,0.00198755623687611,-0.00126788611745541,7.31966670988123e-05,0.000318549346363157,-3.92328259853980e-05,-0.000713155535138128,0.00114274915104189,-0.000226329072167749,-0.000783479039404840,-0.000410669626514162,-0.00131340814018722,-0.000679033762469936,0.000250846837389068,0.00130085474305408,0.00222539206981020,-0.000221508360290350,-0.00177898100731923,-0.000595758895426353,0.000324405183233924,0.000708732202565241,0.000794154413701665,-3.97162231136638e-05,0.000699321596450559,-0.000360380744656667,-0.000558458451999036,0.000391148899403539,-7.96720057998225e-05,5.67334746258597e-05,7.22185663239244e-05,-0.000980682276385301,-0.00146254554395476,-0.000727677571836186,0.000508857409313414,0.000159691148038830,-0.000977112366821065,0.00197372543133186,-0.000515574069853881,0.000101778061787908,0.000466639258092682,0.00161649896649028,-0.00249078578638528,0.00126017360909857,0.000952720079536260,-8.86796806444009e-05,0.000608722714438716,0.000250389993716587,-0.000664866271646973,0.00251094386337107,0.00106549590498134,0.000383625018976566,0.000499815050381342,-0.000750049329650674,-0.00102466606545163,-0.000475338595644959,0.000579084638425255,0.000705103233211517,-0.000869646400162660,-0.000742725789496131,-0.000270393669809058,0.000830110244236282,-0.000703894420232041,-0.00188551844876713,0.000226431631340929,0.00170860709771863,-0.00188628654152906,0.00167610111917811,-0.000721973710137308,-0.000111732657119092,-0.000444012804455422,0.000460159585643984,0.000561871711001787,2.29960474964199e-05,0.000590145299316787,-0.00155064346468709,0.000713392482085456,-0.00155090852783088,2.45213109099999e-05,-0.00133465500140627,-0.00125510629156030,0.000835587409925375,0.000105203862639153,0.000164417114156317,-0.000918492031811743,0.000949207321894477,0.000685330915058988];
noise = [-0.000713664520008285;-0.000992409195199481;0.000892170167285684;-0.00102647014889761;-0.000165031440707351;0.000343592402456885;-8.51904590891135e-05;0.000638228563150966;0.000509813590446551;6.25318956002700e-05;-0.00103779726911775;0.00108615614321625;0.000154119399095728;0.00182536913482167;0.000199208122787596;0.000703388531246896;0.00131054410493673;-0.00126971356609128;0.00122918982118576;-0.00107430404646701;0.00222677785494086;-0.00101871072399133;-0.000908110660966888;-0.000553376278962897;-0.000987051290489509;-0.000481719757009068;-4.31540488419322e-05;-0.000940920999854811;0.00150380989339055;-0.00191584434653099;0.000238689391162540;0.000785468007482892;-0.00214743771758934;0.000272851064241075;-0.000928358635083864;0.000490882519122472;-0.000101181541375399;0.000406161361759142;-0.000321799245207985;-0.000699082100361845;0.00215057492135403;0.000513984555627870;-0.00277484120537161;-0.000300269221253518;-8.74091622114427e-05;-0.00141407800193709;-1.54636622168433e-05;-0.000677592544632771;0.00132232308399166;0.000233391464493662;0.000196489769374868;-0.000181737786529117;-0.000436750927689025;-0.000146012180410903;-0.00194996029784164;-0.000338408086243858;0.000808003690345889;-0.00126792174685606;0.00125764936124081;0.000499431648637200;-0.000270277673936224;0.000217111872481020;0.000300285218273232;0.00135232524122902;-0.00110971981970113;-0.000538513937562124;-6.51898641144334e-05;-0.000691209161766408;0.000332235470354358;0.000119114870864189;0.00233478271797141;-3.54459710448873e-05;-9.61969466904029e-05;0.000283934491789098;0.000742544084524574;0.00119070621751661;-0.000821511455869935;0.000818546392606371;0.000290262684939087;-0.000844629665322848;0.00104587334369662;0.000486760737841332;0.00202917057910591;0.00106104981333425;-0.000697028510368249;0.000598256481045781;-0.000110087132532675;-0.000911936894628871;0.000861009866194505;0.000134855170927286;0.00159617139962938;-0.00102231624103484;-0.000940203382737391;0.000377215542817765;-0.000124775905805078;-0.000993699360793375;0.00135093806986236;0.000170945501414022;0.000215335192438532;-0.00138351725898145;-0.000456416491026856;0.000232905587531927;0.00228096936221733;-0.00132192701242944;-0.000864042029272614;-0.000127983725371489;-9.85761312008874e-05;0.000142166235901503;-0.00162492048624451;0.00200090391632727;-0.00101083608763253;0.00149050831573558;-7.97145424169055e-05;0.00214510276540729;-0.00175462709302975;-0.000855994644389801;-0.00107330914621395;-0.000256197510689313;-5.74888831946447e-05;0.00131271958592332;0.000189314047019778;-5.81641003033527e-05;5.03020883497515e-05;-0.00174233542370630;-0.000106722320408938;0.00170083828247157;0.000517299342746266;0.00296558659293131;0.000810704549331569;-0.000920113754126431;-0.00101289454500262;0.00209152079347708;0.00122132754255976;-0.00151270105371021;-0.00260862109094322;-0.00107920032410856;0.00149604449756043;-0.000237509383961640;-0.000505414062693744;0.000340281818100822;-0.00109277495686299;0.00140497942799984;-0.000268776208372694;0.000186899924473772;-0.000773011163100755;0.000569031840460493;0.00115944989687972;-9.62913117493833e-05;-0.00160772298902224;-0.00103215718334447;0.000275493542326912;-0.000313940306816586;0.00130139970045665;-0.00128219495190447;0.000765693052488820;0.000276118310942775;0.000921314757153468;-0.00163994421952133;-0.000885340195946874;0.000967861700823074;-0.000842551841512864;0.00134525730544031;9.18123813557293e-05;0.000951049994178207;0.00165961106055056;0.000439878132205349;-0.000993596563387015;-0.000978687298076765;0.00109670489282589;0.000477821306854781;-0.000652891592202136;0.000224475082592815;-0.00124375343433258;0.000691905465426418;-0.00147506022849325;-0.00151960882026712;0.00242605933368098;0.00112590677203188;0.00211535478319299;-0.000106056575094306;-3.04536478199554e-05;0.00133740174466250;-0.000440294426597291;-0.00131090496810405;-0.00116945088415690;-9.38447611746433e-05;0.00100740470132806;-0.000278204128182533;-0.000229763134235171;0.000650707608920647;-0.00194698170326199;0.000950397427876301;0.00156762846656264;0.000263489430673950;-0.000519559610812959;0.00225814987689597;0.00149989152840684;0.000703574276219317;-7.65878504666029e-06;0.000140064499322750;-0.000790037948059678;3.19598760464782e-05;-0.00142033478344004;-0.000757148382054948;-0.00148351899410391;-7.19569128996116e-05;-4.80288390620511e-06;0.00161866723881240;-0.000408739836733632;-0.00200798108030746;0.000507902627442550;0.000473170464868096;0.000833551839412004;-0.00165162314345119;-0.00154658733400180;0.000905901897454743;0.000791037300715404;0.00152188937833750;-0.00189329673738770;0.000696726571233958;-0.00170792942274831;-0.000129602988463625;-0.000237641390765278;-0.000258669031761333;0.00159544540456369;0.000633450968015899;0.000183330329907128;0.000547970986761799;-0.000730902322736753;-0.00251506322426078;-0.000755730279563204;-0.00128484588893423;0.00103215655595441;-0.000591668855534638;-0.00158116813899561;-0.00176205592718281;0.000240811017747894;-0.000481232729663052;0.000433314666602036;-0.000972767817343668;0.000400554913035596;0.000989386002755617;-0.000583791117888952;0.00179953780330450;-0.00165498437049976;0.00162125449824735;0.00109820817477593;0.000351608331721863;0.00124235685411574;-0.000277153394141638;-0.00175865021368238;0.000522136715965509;-0.00116100158625511;-0.000687794658741071;0.000246531701017117;1.97710985106823e-05;0.000516887387603580;0.00118042637274972;0.00157872985519163;-0.000265601825318443;-0.00101496715082043;0.000686654047120634;9.13333523081782e-05;-0.000867826257571536;0.000419376094528643;-0.000868227518613676;-0.000427347074265224;0.000422731005280428;0.00218576473233045;-0.000535670927391112;0.00293400935663497;-0.00142298815195533;0.00104721170013508;-0.00254959087735010;0.00216319557081254;0.00135230224733367;0.00187531043766826;-0.000465023626739561;0.00108900216520127;0.000306810379535474;-0.000670906130971562;0.00107716592434791;-0.000432308659264833;-0.000645961338014405;-0.000186329156302359;0.000200176534182743;-0.00141087397378842;-0.00111076095996319;0.00108498077331728;-0.00115711044292975;-0.000544238943456146;-0.000637426567084785;0.00127666462560531;0.000566670830125318;-0.000598383052858236;-0.000495338517224268;-0.00109083019628640;-0.000325523652597672;-0.000414208037714671;0.00127343319543002;-0.000804105032033015;-0.00127112733357065;-0.000708218556633378;-0.00253426401661750;0.000293684686661758;0.00122908293654589;-0.000734083896797241;-0.00212007359409378;-0.000183445336819459;0.000836236212541267;-0.000970354176623792;-0.000307552400037457;-0.00134968580647037;-0.000758772080364178;0.000192138520325267;-0.000194300149342592;-0.000255734415486073;0.000161171072085388;-0.000507017277760063;0.000203465882256979;-0.000581833877168453;0.000228702176882579;-0.00117553225568274;0.00227038385099111;-0.00124983821667627;0.00111545018797295;-0.000745639433469655;-0.00172754066712574;-0.00100893647071401;-0.000282817580649783;-0.000102326279121143;-0.000990083445559557;-0.00135253998054170;0.00193265217401492;0.000245053379828403;0.000688763736950950;-0.00145797516000150;-0.000833969531957225;-0.000886820542547538;0.00130546046173509;-0.000566643002999252;0.00176793815887158;-0.000979958670195423;0.000359003656267561;0.000850868124061318;0.00219227993317811;-0.000808771752046657;0.000263229214393267;-0.000598421321833468;0.000333643757599950;-0.000743763769667727;0.000283472850269431;-0.000828988052703344;-0.000377020656057884;0.000545148020965704;-0.000632144312694823;-0.00118299507015449;0.000545800839524047;0.000234355008062688;-0.00247421987247752;0.000828189007857232;0.000496546393729591;0.000896192687157054;0.000192809743076408;-0.000591912893550206;-0.000467817580894574;0.000304442925175806;-0.000889799682682876;0.000938242675845441;0.000963101628552614;8.25069890691005e-05;0.000462790032273185;0.00125324436568105;-0.000800735391150206;-0.000398998249599679;-0.000107763847635410;-0.000991917868865839;-0.000881831224498995;0.00174995336055402;0.00181049432348278;0.000388480737485371;-0.00111116196948555;-0.00156820129866983;0.00145125012827470;0.00150886992550343;0.000257887107248601;0.00223475032946384;0.000420513653728624;0.00104897900882699;0.000626114531327455;-0.00106691592545026;-0.00127638407399154;-0.000663968494838733;-0.000509400276947295;-0.00155521410838879;-0.000353230894976325;-0.00151140258902315;-0.000292500875681105;-0.000659319629539992;0.000174847688375713;-0.00202702327731904;-0.00184655806679802;-0.000347259915195325;-0.000287829033167562;-0.00320262692131276;-0.000898645862702246;-0.000353247281434113;0.000654637752073022;-0.000280169616466989;0.000730392533039571;-0.000520992744328513;-0.000512351140912862;0.000362180871596989;0.000272108247813447;-0.000220316434193610;0.000610021557262881;0.00152632721875934;0.000550394031807535;-0.000391910382780566;-0.00118673273989713;-0.00131127761942202;0.000358323065638450;-0.000234772578845941;0.000940890074152129;3.53200262195666e-05;-0.000378913398652078;-0.00122028574203201;0.000947277823855008;0.00212204722144182;0.00173778288166977;-0.000580250818483962;-0.000503828536000419;-0.00120952744965913;-0.000197017116005085;-0.00164649692092534;-0.00136983239116938;0.000648654468623784;0.000954327650487030;-4.57654309574031e-05;0.000423370822019282;0.00120689194846761;-6.64100351163363e-06;0.000194011958391228;0.00107403008910271;0.000667572014842615;0.000205785800026764;-0.000100643759630192;-0.000450933967658858;-0.00181466504283933;0.000629680492322372;0.000948729925134881;0.000335975977473562;9.64019308122279e-05;-0.000768432831525456;-0.000858140549265838;0.000195890770780320;-0.00135303247648089;-0.000943163270264357;0.00115390974769833;0.000581340237932235;0.000528902097797910;-9.30138367390974e-05;-0.00117914217779837;-0.00189738790772607;-0.000984064188808068;-0.00196026537228287;0.000278212184780726;-0.00138127751712181;0.000733648512819733;-0.00147214773342057;-8.95481375682355e-05;-0.000798625137721511;0.000666465922411892;0.000880058461097545;-0.000824699882708996;-0.000181615197263236;0.00122255922863521;-0.000394684577895622;0.000850345268394124;0.000322103445424301;-0.00155446416622971;-0.000311494024805225;-0.000848127809191957;0.000966358436337633;-0.000364467062933738;0.00122066861453304;-0.000710260727795662;0.000325791773552669;-6.17792239232980e-05;-0.00189391826715529;0.000320167381706118;-0.00151324864127240;0.000695134602131832;0.000156581897804143;0.00177262292084164;-0.00154476368858702;-0.000174021562318714;-0.00132825394184097;0.00142677235834376;-0.000260853037141732;-0.000632799851477734;0.000152441427093006;-0.000470286916883029;0.00129148145790999;-0.000598230628240229;-7.58211539712847e-05;0.000328978991835616;0.000203928555691742;-0.000681411652659303;-1.14527661115114e-05;0.000379220689427444;-0.00125557211666756;-0.00101837131380891;-7.91423092159124e-05;0.000847910415178260;-0.000245076263164509;0.00156979141238520;0.00213476323024873;-0.00122708650817850;0.00184815606703372;-0.00121895143723989;-0.000258228964994799;-0.00157005772533606;0.00121478166670063;0.000793070638591587;0.00133918632132466;-6.04809475128745e-05;-0.00146716894573723;-0.00105846757349039;-0.000134196258562107;-0.000400035287996337;0.00159706419920738;0.000176365912546896;-0.000936726485787927;-1.13364625802339e-06;-0.00143711094718743;-0.00122456741631251;-0.000454699871155670;0.000283023337205283;-8.85562316739629e-05;0.00101425051406546;0.00100358028202207;-0.00104208863710156;0.000199095043782944;-0.000687875738796464;0.000779563643058099;-0.00191882230506076;-0.000187621536112406;-0.00124549242104852;0.00105777788186228;0.00111708040709094;-0.00115340938156505;0.000266116288597561;0.000414448386896053;-0.000571115207763173;-0.000117627846554507;-0.00115255753279276;-0.000115499853624284;0.00129672265541012;-0.00113679974943163;0.00173998817523250;-0.000508024186537372;0.00100222372933012;-0.00147337077532144;-0.000446590068793627;-0.000199006556493969;-0.000166243740224706;-0.00216289095709644;6.18148232801076e-05;0.00199248799886816;0.000714289816935138;0.00165148577504637;-0.000170453510807467;-0.000902244899210990;-0.000444890416147208;-0.000901242203664490;-0.000605688132674746;-0.00213593392174422;0.000721514850868708;0.00224183917325689;-0.000231474678288431;-0.000232563811928720;0.000916531781538880;-0.000102615726898079;0.000208034220756402;-0.00106220790351385;-0.000389666617857434;-0.000794038352347568;-0.00147507641034815;0.00145497766448212;0.000905931107605113;-0.00221787229370262;-0.000200293152473746;-0.00125234359566278;-8.45953607874258e-05;-2.81920030137436e-05;0.00162962780966798;-0.000885646984066872;0.000372239269364540;0.000815373334093027;0.000128260108396741;-0.000586902841348014;0.000402972689195295;0.00116051955678115;-0.000951446069144603;0.000209843393976145;0.00124214904335185;-0.00142984221508724;-0.000312159875345463;0.000474822539592948;0.000202530577168164;-0.000582323903203946;-0.000905204616571715;-0.000500126561589888;0.00171431679258672;-0.000131261935376089;-0.00145568422044651;0.000183494778883329;0.00155479144269640;0.000686355534441575;0.000288436607575909;-0.000311904380549457;-0.000858086553121513;0.00163210347185570;-0.000241996534838623;-0.000559841348808421;0.000232010465122314;-0.000136189550248422;-0.000762948337092818;0.00106922339904881;0.000241183629749846;0.000946698459238334;-0.00118562893750705;0.000181785733629692;0.00103268607159023;-0.000508240730562434;0.00145903219053202;-0.000570223061623377;-0.000720722621801907;-0.000602910484666848;-0.000472788917640897;9.37487068830394e-06;-0.000385458489177370;0.00269711645213190;-0.000754597970316635;0.000351033553689695;0.000758497652041407;-0.00110972695760160;-0.00140370312927613;-0.00278417556182534;-0.000433669557581475;0.000516076532358436;0.00156747604569701;-0.000624140291213736;3.61277398500288e-05;-0.00104791240580405;-0.000264444291186491;0.000496935432297375;-0.000968273273601807;-0.000976492080398801;-0.00211522524130466;-0.000146217227184192;0.00121608568665133;-0.00172211618058389;0.000803853351560229;0.000885766031377987;-2.29965180410761e-05;-0.000108374066899123;0.000121826698636366;-0.000528201812864677;0.000269903803744802;0.00221447879052604;-3.13414301209881e-05;0.000411932416891112;-0.000322623568644743;0.000681405178635710;0.00243095016618153;0.000805916846729968;-0.00120395733690618;0.000131590651295158;-0.000714333370890229;-0.000336329641759465;0.00176782127510341;-0.00125189910861356;0.00152634285777332;0.000386262265839290;-0.000398721049923643;0.000367362930140926;0.00107038577816556;0.000834625993811212;-0.000335413336962395;0.000356284878129477;0.000410062960414490;-0.000905374146059828;-0.00100202721001473;0.00140120714892920;-0.000568841317704252;-0.000852678351263066;4.33039723244794e-05;-0.000407946063680414;0.000567390482602265;0.00119498627085418;0.00238076591891056;-0.000437512967007274;0.000115087130035860;0.000325086290920634;0.00188222759647883;-0.000634183701906366;-0.00101607217760922;-0.000233051090963613;0.000353718821272907;0.000467789401992845;-0.000456511655222057;0.000793388361014839;-0.000585350601328666;-0.00205072975662753;-0.000911382784372111;0.000229860388686023;-0.000807750323186869;-0.000796959392905548;-0.000151285594218026;-0.00131675202324181;-0.000757279280213068;-0.000295317569758733;0.00298211848231370;0.000443141773497725;-0.000151238152604760;-0.00100219154036018;0.00114036578523773;-0.000225929170813904;-0.000597411474681030;-0.000515690362675462;7.48565667452114e-05;0.00125655379382358;0.00173134440793186;0.000450658144788584;0.00216676213694231;-0.00132254248543785;-0.000648445058219344;0.00109905610267544;0.000851313296330914;0.000455239918274519;-0.000636843960038425;0.000208381003546143;0.000443888542402366;0.00185312609472545;0.00207185851784927;-0.000401195931647141;-0.000255959700500574;8.34654271043428e-05;1.81812100789325e-05;-0.00273644187038457;-0.00128886241849063;-0.000492890383592924;-0.00205009985360745;0.000338482520971777;-0.000376743700199113;0.000186658933121725;-0.000418592188021143;0.00115635915980912;0.000249574327447863;0.000451566034598099;-0.00181183954120261;-6.73470781484276e-06;-0.000452204913461193;0.000174581243851803;-0.00107901726353776;-0.00176581804877497;0.000142999374152873;-0.000260550323945671;0.000412234016173060;0.00216065871747753;-0.000438691530520320;-0.000496493571329443;0.000784325831086587;0.000754695508910441;0.000768153034527354;-8.05231521142542e-05;7.63335844118085e-05;0.00314701923612638;-0.000992327647751784;-0.00121334755717333;0.00115199118282810;-0.000374726087242289;-0.000127833288757827;0.000207347671479716;-0.000125326463320329;-0.000476581545238473;-0.00156740913761592;-0.00256065368147110;-0.00102464734313839;-0.000933077916780919;5.41661638251909e-06;-0.000365119830538295;-0.000317568182094975;0.00129135926070363;0.00207382005962750;0.000739662126926881;-0.00200673509854317;0.000967244502619202;-0.000445291421972097;-0.00135325770208019;0.000335693264178896;0.000401480229886141;0.000296867060360344;-0.00159436352023735;0.00101273751534507;-0.000113460193649596;-0.000982521749155989;0.000785215048864495;-0.00111942613234361;0.000314583367395503;0.000456166067982896;-0.00218578011741953;-0.00230517936096263;-0.000926466120279069;0.000711287049544936;0.00152286675664286;-7.23481112057441e-05;-2.46469575421234e-05;3.31595857773655e-05;-0.000371166144172298;-0.000332979998044880;-0.000437702650017028;0.00158918775806205;-0.00168425838790683;0.000489113597806692;0.000236398322196671;0.000417382438229639;-0.000598113146045963;8.39135123997855e-05;0.00105821737038354;1.91141664496464e-05;-0.000899045768093307;-0.00219760109851105;0.000498614331128135;0.00132394623018075;5.36667175463287e-05;-0.000205552352507032;0.000815282126970796;0.00157307225003903;0.000249881295323018;-0.00217348359718791;0.000786417095325544;0.000424075730059826;-6.15017789567778e-05;-0.000569021090090126;-5.44599349073926e-05;0.000828201378060929;-0.000518742225028556;0.00125515252602831;0.00112200942206784;2.87437757759065e-05;0.000339132785029993;0.000229540826513159;0.000535324171343414;-0.00129514799632713;-0.000397485285843362;0.000779247230412256;-0.00144023136021140;-0.000385090113343334;0.00103327383294297;0.000127180207955522;-0.000115390843998435;0.00113464487915409;-0.00184399537880600;0.00108194100446799;-0.000970802052872258;0.000966296974863229;-0.000191288445449564;0.000655443490802495;-0.000233225592893054;0.00136008596125185;-0.000471521044904702;-0.00108135924625997;0.000236632576055712;-0.000453125004937391;-0.00120615348135539;-0.00103121485566848;-0.000704998554028669;-0.000385242336520715;0.000236859963574230;0.000204422727486379;-7.23302463643202e-05;-0.00200222682361554;0.000722114516663767;-0.000536320292884090;-0.000267050669205130;-0.00144333631489382;0.000963876853055382;0.000121311623087527;0.000651207335393533;-0.000914894391292702;-0.000694498228181847;1.89214956786560e-05;-0.000257845751005788;-0.00181550654018014;-0.000862725193697927;-0.000967399586945807;0.00241847966394532;-0.000360169911667929;-0.00115844118806723;-0.000281212118298511;0.00104722132590905;-0.000882169317488343;-0.00110717596913604;0.000515249644366941;-0.000991859043240155;8.70689659945674e-05;0.00109528131518728;-0.000418855942454995;0.00121512273018473;-0.000409466576079912;-0.00150527636175112;-0.000439905182546062;0.000508755798324258;-0.00186538124386420;-0.000761637508313452;-0.000156351177132662;-7.97886481172230e-05;-0.000258950529576127;-0.000167602714187471;-0.00154053527275927;-0.00193935576582446;0.000300297426291580;0.00167305893707527;3.42467001440729e-05;0.000367206352397558;-0.000965092520438465;-0.00135477163692842;-0.000530534145343289;-0.000464460974784050;-0.00159795625937038;-0.00100795294979023;0.000258086410249703;-0.000533786645847219;-0.000685033361696213;0.000423394042102091;-0.000305236946002293;-2.32388952207023e-05;-0.000918802252541697;-0.00245279189432706;-0.00188260199432293;0.000646871093873529;0.000888631213164213;0.000633072496460075;-0.00169025819066801;-0.00208977993603899;0.00225405696943307;-0.000524705465629575;0.00317838284383755;0.000514312768454787;0.00206349041321880;-0.000268828869458909;0.000201295279106416;3.20650336039802e-05;-0.000269226536400318;0.00115498234969459;-0.000233998325278747;-0.000318722956975956;0.000741732316020086;-0.000270022804660098;-0.00212315991069432;-0.00107690239573693;0.000127093951371279;-0.00118358998544591;0.000462125925004918;-0.00146492030918425;0.00118488759796886;0.000387859762226840;0.000806205380128256;-0.000946894676256592;-0.000354852951098352;0.000719758049273776;0.000305048979503015;-0.000486870753346882;0.000844995570809133;0.000544123162410442;0.000276980890301596;-0.00151095592958406;0.000294329177440107;0.00109020672730261;0.000760892621325904;-0.000703696136889906;0.000588333513519894;0.00169722867425544;-0.000650455914040437;-0.00110038204417662;-0.000189293405488921;-0.000459007665379914;-0.000734598354318546;-0.000442918747483581;0.000164178217867028;-0.000192443215606130;0.000575817582374443;-0.000208937882085537;0.00240518691817766;-5.58254166155708e-05;0.000843917141904570;-0.00121998214789974];
manuel = 1;
    if (manuel == 1)
%     S_real = [1 -1 ];
%     n_source = length(S_real);
%     ang1 = 0.846; small_ang = 0.02;
%     ang2 = ang1 + small_ang;
%     fan_range = ang2 - ang1;
%     ang_stp = (fan_range)/(n_source-1);
%     ths_real = ang1:ang_stp:ang2;
%     rs_real = 0.7;
    
    S_real = [1 -1 1 -1];
    n_source = length(S_real);
    ang1 = 0.846; small_ang = 0.05;
    ang2 = ang1 + small_ang;
    ang3 = ang2 + 100*small_ang; ang4 = ang3 + small_ang;
    fan_range = ang2 - ang1;
    ang_stp = (fan_range)/(n_source-1);
    ths_real = [ang1 ang2 ang3 ang4];
    rs_real = 0.7;
    
    
    end
    if (manuel == 3)  
%     S1 = 10*rand(n_sp,1);
%     S1 = S1/sum(S1);
%     S2 = -10*rand(n_sm,1);
%     S2 = -S2/sum(S2);
%     S = [S1;S2];
    fan_range = 2*pi;  % scattered range angle 
    [S_real,dummy0] = randfixedsum(6,1,0,-1,1);
    n_source = length(S_real);
    ths_real = fan_range*rand(1,n_source);
    rs_real = 0.7;
    end

rs_real = rs_real*ones(1,n_source);

for i = 1:n_source 
phi_real(:,i) = (S_real(i)/(2*pi))*log(sqrt(1+rs_real(i)^2 ...
    -2*rs_real(i)*cos(theta-ths_real(i))));
end

phi_real = 2*sum(phi_real,2);
data_measure = phi_real + level*randn(size(phi_real));
data_measure = phi_real + noise;
% figure(1) 
% plot(data_measure);
y2 = fft(phi_real,n_sample);                             % Compute DFT of x
m2 = abs(y2);                               % Magnitude
p2 = unwrap(angle(y2));                     % Phase
an2 = (2/(n_fft-1))*real(y2);
bn2 = -(2/(n_fft-1))*imag(y2);

%%%%%%% Set up constraints for the fsolve
%%% 1. nutral source strength constraint
temp_A = [1 0 0];
Aa = [repmat(temp_A,1,n_source)];    
ba = [0];

%%% 2. upper and lower bound for source strength constraint
K=2*max(S_real);
temp_A1 = [1 1/K pi/K];
temp_A2 = [1 1/K pi/K];

lb = [-K*repmat(temp_A1,1,n_source)]';
ub = [K*repmat(temp_A2,1,n_source)]';

%%% 3. non-linear constraint for locations
% f_c = @(x) circle_con2(x,n_source);    

%%% random initial point for optimization
% x0 = 1+randn(3*n_source,1);
%%% non_random initial point
x0=-4:(8/(3*n_source-1)):4;
kkk = 1;
for ii = str:fin
% lam_J = ii*10^(-5);
for kk = 1:inner_lam
lam_J = kk*10^(-ii);

% options = optimoptions(@fmincon,'PlotFcn',@optimplotfirstorderopt,'FunctionTolerance',1e-16,...
%     'MaxFunctionEvaluations',13000);
opts = optimoptions(@fminunc,'PlotFcns',{@optimplotfval,@optimplotx},...
    'MaxIterations',30000,'MaxFunctionEvaluations',90000,...
    'OptimalityTolerance',1e-16,'StepTolerance',1e-16);
problem = createOptimProblem('fmincon','x0',x0, ...
    'objective',@objective_fun,'Aeq',Aa,'beq',ba,'lb',lb,'ub',ub,...
    'options',opts);



x_soln = fmincon(problem);

k=1;
for i=1:n_source
S_soln(i) = x_soln(k);
rs_soln(i) = x_soln(k+1);
ths_soln(i) = x_soln(k+2);
k=k+3;
end
 xs_soln = rs_soln.*cos(ths_soln); ys_soln = rs_soln.*sin(ths_soln);

figure(11)
 xs = rs_real.*cos(ths_real); ys = rs_real.*sin(ths_real);
 x = cos(theta); y1 = sin(theta);
 plot(x,y1); hold on;
    k = 1;
    for i = 1:n_source
        scatter(xs(i),ys(i));
        text1 = S_soln(k);
        text1 = num2str(text1);
        text1 = cellstr(text1);
        k = k + 1;
        text_fin =text(xs(i),ys(i),text1);
        fontsize = text_fin.FontSize;
        text_fin.FontSize = 12;
        hold on;
    end

figure(12)
 plot(x,y1); hold on;
    k = 1;
    for i = 1:n_source
        scatter(xs(i),ys(i),'*');
        text1 = S_real(k);
        text1 = num2str(text1);
        text1 = cellstr(text1);
        k = k + 1;
        text_fin =text(xs(i),ys(i),text1);
        fontsize = text_fin.FontSize;
        text_fin.FontSize = 10;
        hold on;
    end
    
    k = 1;
    for i = 1:n_source
        scatter(xs_soln(i),ys_soln(i),'d');
        text2 = S_soln(k);
        text2 = num2str(text2);
        text2 = cellstr(text2);
        k = k + 1;
        text_fin1 =text(xs_soln(i),ys_soln(i),text2);
        fontsize = text_fin1.FontSize;
        text_fin1.FontSize = 10;
        hold on;
    end
% err1(ii,:) = abs(S_soln) - abs(S_real);
% err2(ii) = norm(err1(ii,:),2);
% err3(ii,:) = abs(rs_real) - (rs_soln);
% err4(ii) = norm(err3(ii,:),2);
% err(ii) = err2(ii) +err4(ii);
rec_S(kkk,:) = S_soln;
rec_rs(kkk,:) = rs_soln;
rec_ths(kkk,:) = ths_soln;
kkk = kkk + 1 ;
end
end

for i = 1:n_source 
phi_soln(:,i) = (S_soln(i)/(2*pi))*log(sqrt(1+rs_soln(i)^2 ...
    -2*rs_soln(i)*cos(theta-ths_soln(i))));
end
phi_soln = 2*sum(phi_soln,2);

figure(2)
plot (theta,data_measure); hold on; plot (theta,phi_soln,'*');
ylabel('\phi(\theta)')
xlabel('\theta')
legend('data \phi_d','reconstructed data \phi(\theta,s)')


rec_ths(1,2) = rec_ths(1,2)-pi;
err_total1 = abs((abs(rec_S(:,1)) - 1)/1) ;
err_total2 = abs(abs(rec_rs(:,1)) - 0.7)/0.7 ;
err_total3 = abs(((rec_ths(:,2)) - rec_ths(:,1))-pi) ;
err_total3 = abs(err_total3-0.02)/0.02;
err_total4 = abs((pi-abs(rec_ths(:,1))) - ang1)/ang1 ;
err_total5 = abs((rec_ths(:,2)) - ang2)/ang2 ;


% figure(3)
% plot(str:fin,err_total1,'-*');
% ylabel('intensity error %')
% xlabel('-log(\lambda)')

% figure(4)
% plot(str:fin,err_total2,'-*');
% ylabel('rs error %')
% xlabel('-log(\lambda)')
% 
% figure(5)
% plot(str+1:fin,err_total3(2:end),'-*');
% ylabel('\theta_2 -\theta_1 error %')
% xlabel('-log(\lambda)')
% 
% figure(6)
% plot(str:fin,err_total4,'-*');
% ylabel('\theta_1 error %')
% xlabel('-log(\lambda)')
% 
% figure(7)
% plot(str:fin,err_total5,'-*');
% ylabel('\theta_2 error %')
% xlabel('-log(\lambda)')